<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ahnu.activity_api.dao.RoleAdminDao">

<!--//    获取角色列表
    List<Role> GetRoleList();-->
    <resultMap id="GetRoleListResultMap" type="Role">
        <id property="roleId" column="role_id"></id>
        <result property="roleName" column="role_name"></result>
        <result property="roleDescribe" column="role_describe"></result>
        <result property="powerId" column="power_id"></result>
        <collection property="power" ofType="Power">
            <id property="powerId" column="power_id"></id>
            <result property="powerName" column="power_name"></result>
            <result property="moduleId" column="module_id"></result>
        </collection>

    </resultMap>
    <select id="GetRoleList" resultMap="GetRoleListResultMap">
        SELECT * FROM activity_role r
        LEFT JOIN activity_power p ON r.`power_id` = p.`power_id`
    </select>

<!--    //    获取权限列表
    List<Power> GetPowerList();-->
    <select id="GetPowerList" resultType="Power">
        SELECT * FROM activity_power
    </select>


<!--    //    获取模块列表
    List<Module> GetModuleList();-->
    <select id="GetModuleList" resultType="Module">
        select * FROM activity_module
    </select>


<!--    //    获取模块列表根据权限ID
//    根据权限id获取模块列表
    Power GetModuleByPowerId(@Param("power_id")Integer power_id);-->
    <select id="GetModuleByPowerId" resultType="Power">
        SELECT * FROM activity_power WHERE power_id = #{power_id}
    </select>
<!--    //    获取模块列表根据权限ID
    Module GetModuleListByModuleId(@Param("module_id")Integer module_id);
-->
    <select id="GetModuleListByModuleId" resultType="Module">
        select * from activity_module WHERE module_id = #{module_id}
    </select>

<!--    //    添加角色
    Integer AddRoleInfo(Role role);-->
    <insert id="AddRoleInfo" parameterType="Role">
        insert into activity_role set role_name = #{roleName},role_describe=#{roleDescribe},power_id=#{powerId}
    </insert>


<!--    //    修改角色信息根据roleId
    Integer EditRoleInfoById(Role role);-->
    <update id="EditRoleInfoById" parameterType="Role">
        update activity_role set role_name = #{roleName},role_describe=#{roleDescribe} where role_id = #{roleId}
    </update>


<!--    //    修改角色表中权限信息
    Integer EditRolePowerIdInfo(Role role);-->
    <update id="EditRolePowerIdInfo" parameterType="Role">
        update activity_role set power_id = #{powerId} where role_id = #{roleId}
    </update>


<!--    //    添加权限
    Integer AddPowerInfo(Power power);-->

    <insert id="AddPowerInfo" parameterType="Power">
        insert into activity_power(power_name) values (#{powerName})
    </insert>


<!--    //    编辑权限
    Integer EditPowerInfoById(Power power);-->
    <update id="EditPowerInfoById" parameterType="Power">
        update activity_power set power_name = #{powerName} where power_id = #{powerId}
    </update>


<!--    //    修改权限表中的模块字段
    Integer EditPowerModuleList(Power power);-->
    <update id="EditPowerModuleList" parameterType="Power">
        update activity_power set module_id = #{moduleId} where power_id = #{powerId}
    </update>

<!--        //    删除权限
//    第一步：查询角色表中是否有当前的权限id
    Integer SearchRoleIsPowerId(@Param("power_id")Integer power_id);-->
    <select id="SearchRoleIsPowerId" resultType="int">
        SELECT COUNT(*) FROM activity_role WHERE power_id = #{power_id}
    </select>
<!--    //    第二步：删除
    Integer DeletePowerById(@Param("power_id")Integer power_id);-->
    <delete id="DeletePowerById">
        delete
        from activity_power
        where power_id = #{power_id};
    </delete>


<!--    //    删除角色
//    第一步：查询staff表中角色id个数
    Integer SearchStaffAndRoleId(@Param("role_id")Integer role_id);-->
    <select id="SearchStaffAndRoleId" resultType="int">
        SELECT COUNT(*) FROM activity_staff WHERE role_id = #{role_id}
    </select>
<!--    //    第二步：删除
    Integer DeleteRoleById(@Param("role_id")Integer role_id);-->
    <delete id="DeleteRoleById">
        delete
        from activity_role
        where role_id = #{role_id};
    </delete>

<!--    //    根据角色id查询模块id
    Integer SearchModuleIdByRoleId(@Param("role_id")Integer role_id);-->
    <select id="SearchModuleIdByRoleId" resultType="int">
        select power_id from activity_role where role_id = #{role_id}
    </select>

<!--    //    根据权限id查询模块id列表
    String SearchModuleIdListByPowerId(@Param("power_id")Integer power_id);-->
    <select id="SearchModuleIdListByPowerId" resultType="string">
        select module_id from activity_power where power_id = #{power_id}
    </select>

<!--    //    根据模块id获取相关信息
    Module SearchModuleInfoByModuleId(@Param("module_id")Integer module_id);-->
    <select id="SearchModuleInfoByModuleId" resultType="Module">
        select * from activity_module where module_id = #{module_id}
    </select>



</mapper>